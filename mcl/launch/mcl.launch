<launch>
  <!-- Launch arguments -->
  <arg name="car_name" default="car"/>
  <arg name="real"     default="false"/>
  <arg name="control"  default="false"/>

  <!-- MCL arguments -->
  <arg name="mcl_num_particles_min"     default="1000"/>
  <arg name="mcl_num_particles_max"     default="200000"/>
  <arg name="mcl_kld_eps"               default="0.01"/>
  <!-- <arg name="mcl_hist_pos_res"          default="0.1"/>
  <arg name="mcl_hist_th_res"           default="0.1745329252"/> --><!-- pi/18 (10 deg)-->
  <arg name="mcl_hist_pos_res"          default="0.05"/>
  <arg name="mcl_hist_th_res"           default="0.0872664626"/> <!-- pi/36 (5 deg)-->
  <arg name="motion_lin_vel_n1"         default="0.01"/>
  <arg name="motion_lin_vel_n2"         default="0.01"/>
  <arg name="motion_ang_vel_n1"         default="0.01"/>
  <arg name="motion_ang_vel_n2"         default="0.01"/>
  <arg name="motion_th_n1"              default="0.01"/>
  <arg name="motion_th_n2"              default="0.01"/>
  <arg name="sensor_range_no_obj"       default="16.0"/>
  <arg name="sensor_std_dev"            default="1.0"/>
  <arg name="sensor_th_sample_res"      default="0.7853981634"/> <!-- pi/4 (45 deg) -->
  <arg name="sensor_th_raycast_res"     default="0.0314159265"/> <!-- pi/100 -->
  <arg name="sensor_new_obj_decay_rate" default="0.25"/>
  <arg name="sensor_weight_no_obj"      default="15.0"/>
  <arg name="sensor_weight_new_obj"     default="4.0"/>
  <arg name="sensor_weight_map_obj"     default="80.0"/>
  <arg name="sensor_weight_rand_effect" default="1.0"/>
  <arg name="sensor_uncertainty_factor" default="1.1"/>
  <arg name="sensor_table_res"          default="0.005"/>

  <!-- Control enabled -->
  <group if="$(arg control)">
    <!-- Real control -->
    <group if="$(arg real)">
      <include file="$(find mushr_base)/launch/teleop.launch">
        <arg name="car_name" value="$(arg car_name)"/>
      </include>
    </group>
    <!-- Sim control -->
    <group unless="$(arg real)">
      <include file="$(find mushr_sim)/launch/teleop.launch">
        <arg name="car_name" value="$(arg car_name)"/>
      </include>
    </group>
  </group>

  <!-- Control disabled -->
  <group unless="$(arg control)">
    <!-- Map -->
    <include file="$(find mushr_base)/launch/map_server.launch"/>

    <group ns="$(arg car_name)">
      <!-- Real laser -->
      <group if="$(arg real)">
        <include file="$(find ydlidar)/launch/lidar.launch">
          <arg name="car_name" value="$(arg car_name)"/>
        </include>
      </group>
      <!-- Sim laser -->
      <group unless="$(arg real)">
        <include file="$(find mushr_sim)/launch/sensors.launch">
          <arg name="car_name"   value="$(arg car_name)"/>
          <arg name="standalone" value="true"/>
        </include>
      </group>
      <!-- Motor (parameters) -->
      <group ns="vesc">
        <rosparam file="$(find vesc_main)/config/racecar-uw-nano/vesc.yaml" command="load"/>
      </group>
    </group>
  </group>

  <!-- MCL -->
  <group ns="$(arg car_name)">
    <node pkg="mcl" type="mcl" name="localizer" output="screen">
      <param name="mcl_num_particles_min"     type="int"    value="$(arg mcl_num_particles_min)"/>
      <param name="mcl_num_particles_max"     type="int"    value="$(arg mcl_num_particles_max)"/>
      <param name="mcl_kld_eps"               type="double" value="$(arg mcl_kld_eps)"/>
      <param name="mcl_hist_pos_res"          type="double" value="$(arg mcl_hist_pos_res)"/>
      <param name="mcl_hist_th_res"           type="double" value="$(arg mcl_hist_th_res)"/>
      <param name="motion_lin_vel_n1"         type="double" value="$(arg motion_lin_vel_n1)"/>
      <param name="motion_lin_vel_n2"         type="double" value="$(arg motion_lin_vel_n2)"/>
      <param name="motion_ang_vel_n1"         type="double" value="$(arg motion_ang_vel_n1)"/>
      <param name="motion_ang_vel_n2"         type="double" value="$(arg motion_ang_vel_n2)"/>
      <param name="motion_th_n1"              type="double" value="$(arg motion_th_n1)"/>
      <param name="motion_th_n2"              type="double" value="$(arg motion_th_n2)"/>
      <param name="sensor_range_no_obj"       type="double" value="$(arg sensor_range_no_obj)"/>
      <param name="sensor_std_dev"            type="double" value="$(arg sensor_std_dev)"/>
      <param name="sensor_th_sample_res"      type="double" value="$(arg sensor_th_sample_res)"/>
      <param name="sensor_th_raycast_res"     type="double" value="$(arg sensor_th_raycast_res)"/>
      <param name="sensor_new_obj_decay_rate" type="double" value="$(arg sensor_new_obj_decay_rate)"/>
      <param name="sensor_weight_no_obj"      type="double" value="$(arg sensor_weight_no_obj)"/>
      <param name="sensor_weight_new_obj"     type="double" value="$(arg sensor_weight_new_obj)"/>
      <param name="sensor_weight_map_obj"     type="double" value="$(arg sensor_weight_map_obj)"/>
      <param name="sensor_weight_rand_effect" type="double" value="$(arg sensor_weight_rand_effect)"/>
      <param name="sensor_uncertainty_factor" type="double" value="$(arg sensor_uncertainty_factor)"/>
      <param name="sensor_table_res"          type="double" value="$(arg sensor_table_res)"/>
    </node>
  </group>
</launch>