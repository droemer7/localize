<launch>
  <!-- Launch arguments -->
  <arg name="car_name"         default="car"/>
  <arg name="node_name"        default="localizer"/>
  <arg name="real"             default="false"/>
  <arg name="load_map_altered" default="true"/>

  <!-- MCL arguments -->
  <arg name="num_particles_min" default="1000"/>
  <arg name="num_particles_max" default="10000"/>

  <!--
  Serve the localizer with an altered map for stress testing against dynamic or cluttered environments.
  To use this feature you must create both an altered map and edit the map_altered.yaml config file to load it.
  Altered map must have the same parameters (width, height, origin, orientation) as the 'actual' map.
  -->
  <group if="$(arg load_map_altered)">
    <node pkg="map_server" type="map_server" name="map_altered_server" args="$(find mcl)/maps/map_altered.yaml">
      <remap from="map" to="map_altered"/>
    </node>
  </group>

  <!-- Real -->
  <group if="$(arg real)">
    <!-- Teleop -->
    <include file="$(find mushr_base)/launch/teleop.launch">
      <arg name="car_name" value="$(arg car_name)"/>
    </include>
  </group>

  <!-- Sim -->
  <group unless="$(arg real)">
    <!-- Teleop -->
    <include file="$(find mushr_sim)/launch/teleop.launch">
      <arg name="car_name"        value="$(arg car_name)"/>
      <arg name="force_in_bounds" value="false"/>
    </include>
  </group>

  <!-- MCL -->
  <group ns="$(arg car_name)">
    <node pkg="mcl" type="mcl" name="$(arg node_name)" output="screen">
      <param name="num_particles_min"        type="int"    value="$(arg num_particles_min)"/>
      <param name="num_particles_max"        type="int"    value="$(arg num_particles_max)"/>
      <param name="localizer_node_name"      type="string" value="$(arg node_name)"/>
      <param name="drive_node_name"          type="string" value="vesc"/>
      <param name="sensor_node_name"         type="string" value="laser"/>
      <param name="map_frame_id"             type="string" value="map"/>
      <param name="base_frame_id"            type="string" value="$(arg car_name)/base_link"/>
      <param name="wheel_back_left_frame_id" type="string" value="$(arg car_name)/back_left/wheel_link"/>
      <param name="real"                     type="bool"   value="$(arg real)"/>
      <param name="load_map_altered"         type="bool"   value="$(arg load_map_altered)"/>
    </node>
  </group>
</launch>
